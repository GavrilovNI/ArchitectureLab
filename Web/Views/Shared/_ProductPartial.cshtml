@using System.Globalization
@using Microsoft.AspNetCore.Identity
@using Web.Areas.Identity.Data
@using Web.Data.Models
@model ProductInfo

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
	string productId = "product-" + Model.Product.Id;
}

<div class="col-lg-4" id = "@productId">
	@{
		if(@Model == null || @Model.Product == null) {
			<p>Product not found</p>
		}
		else
		{
			<img class="img-thumbnail" src="~/@Model.Product.LinkToImage" alt="@Model.Product.Name" />
			<h2>@Model.Product.Name</h2>
			<p>@Model.Product.Description</p>

			string idLeftCount = productId + "-leftCount";
			int leftCount = Model.Product.AvaliableAmount;
			if (User.Identity.IsAuthenticated)
				leftCount -= Model.CountInCart;

			<p>Left: </p>
			<p id="@idLeftCount">@leftCount</p>
			<p>Price: @Model.Product.Price.ToString("c", CultureInfo.CreateSpecificCulture("ru-RU"))</p>
			@if (User.Identity.IsAuthenticated)
			{
				<div class="button-class">
					@{
						string idBtnAdd = productId + "-add";
						string idBtnRemove = productId + "-remove";
						string idCount = productId + "-count";
					}
					<div class="number">
						<button class="bt_minus" type="button" id="@idBtnRemove" onclick="RemoveItem(@Model.Product.Id)">
							<svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
						</button>
						<input type="number" id="@idCount" value="@Model.CountInCart" class="quantity" onchange="SetItemCount(@Model.Product.Id)"/>
						<button class="bt_plus" type="button" id="@idBtnAdd" onclick="AddItem(@Model.Product.Id)">
							<svg viewBox="0 0 24 24"><line  x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
						</button>
					</div>
					<br>		
				</div>
				if(User.IsInRole("Admin")) {
					string idEdit = productId + "-edit";
					string idBill = productId + "-bill";
					string href = "../product/edit?itemid=" + Model.Product.Id;
					<a class="nav-link px-2 text-black" id="@idEdit" href="@href">Edit</a>
					href = "../product/bill?itemid=" + Model.Product.Id;
					<a class="nav-link px-2 text-black" id="@idBill" href="@href">Bill</a>
				}
			}
			

		}
	}

</div>
